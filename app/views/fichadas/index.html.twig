{% extends 'layout/base.html.twig' %}

{% block content %}
    <a href="#" onclick="history.back(); return false;" class="back-link">
        <i class="fas fa-arrow-left"></i> Volver a la Vista Anterior
    </a>

    <div class="fichadas-header">
        <h1>{{ page_title }}</h1>
    </div>

    <div class="filters">
        <form action="/fichadas" method="get">
            <input type="hidden" name="tarjeta" value="{{ tarjeta_agente }}">
            <select name="anio">
                {% for i in anio_actual..2000 %}
                    <option value="{{ i }}" {{ (i == anio_seleccionado) ? 'selected' : '' }}>{{ i }}</option>
                {% endfor %}
            </select>
            <select name="mes">
                {% for num, nombre in meses_espanol %}
                    <option value="{{ num + 1 }}" {{ ((num + 1) == mes_seleccionado) ? 'selected' : '' }}>{{ nombre }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn-view">Filtrar</button>
        </form>
    </div>

    <table class="calendar-table">
        <thead>
            <tr><th>Domingo</th><th>Lunes</th><th>Martes</th><th>Miércoles</th><th>Jueves</th><th>Viernes</th><th>Sábado</th></tr>
        </thead>
        <tbody>
            <tr>
                {% for day_data in calendar_days %}
                    <td class="{{ day_data.classes|join(' ') }}">
                        <div class="day-number">{{ day_data.day }}</div>
                        {% if day_data.fichadas is not empty %}
                            <ul class="fichada-list">
                                {% for hora in day_data.fichadas %}
                                    <li class="fichada-item"><i class="fas fa-clock"></i> {{ hora }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                        {% if day_data.horas_trabajadas is not null %}
                            <div class="total-hours-badge" data-tooltip="Horas Trabajadas"><i class="fas fa-stopwatch"></i> {{ day_data.horas_trabajadas }} hs</div>
                        {% endif %}
                    </td>
                    {% if loop.index is divisible by(7) and not loop.last %}
                        </tr><tr>
                    {% endif %}
                {% endfor %}
            </tr>
        </tbody>
    </table>
{% endblock %}